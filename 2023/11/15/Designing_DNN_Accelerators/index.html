<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo_treeby.svg" color="#222">
  <link rel="manifest" href="/images/manifest.json">
  <meta name="msapplication-config" content="/images/browserconfig.xml">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<link href="https://fonts.googleapis.com/css?family=Noto+Serif+SC|Roboto&display=swap" rel="stylesheet">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs | buttons","Available values":"disqus | changyan | disqus | disqusjs | gitalk | livere | valine","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="credit to Eﬃcient Processing of Deep Neural Networks》  Key Metrics  Energy consumption  减少数据的移动(data movement) 减少移动单位数据的代价  Performance in terms of throughput and latency  增加并行度(parallel)">
<meta property="og:type" content="article">
<meta property="og:title" content="Designing_DNN_Accelerators">
<meta property="og:url" content="http://example.com/2023/11/15/Designing_DNN_Accelerators/index.html">
<meta property="og:site_name" content="Amusement Park">
<meta property="og:description" content="credit to Eﬃcient Processing of Deep Neural Networks》  Key Metrics  Energy consumption  减少数据的移动(data movement) 减少移动单位数据的代价  Performance in terms of throughput and latency  增加并行度(parallel)">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/2023/11/15/Designing_DNN_Accelerators/1700057619410.png">
<meta property="og:image" content="http://example.com/2023/11/15/Designing_DNN_Accelerators/1700058040471.png">
<meta property="og:image" content="http://example.com/2023/11/15/Designing_DNN_Accelerators/1700058946892.png">
<meta property="og:image" content="http://example.com/2023/11/15/Designing_DNN_Accelerators/1700059062834.png">
<meta property="og:image" content="http://example.com/2023/11/15/Designing_DNN_Accelerators/1700059237627.png">
<meta property="og:image" content="http://example.com/2023/11/15/Designing_DNN_Accelerators/1700059779411.png">
<meta property="og:image" content="http://example.com/2023/11/15/Designing_DNN_Accelerators/1700059801549.png">
<meta property="og:image" content="http://example.com/2023/11/15/Designing_DNN_Accelerators/1700062976339.png">
<meta property="og:image" content="http://example.com/2023/11/15/Designing_DNN_Accelerators/1700063409653.png">
<meta property="og:image" content="http://example.com/2023/11/15/Designing_DNN_Accelerators/1700063949353.png">
<meta property="og:image" content="http://example.com/2023/11/15/Designing_DNN_Accelerators/1700064715944.png">
<meta property="og:image" content="http://example.com/2023/11/15/Designing_DNN_Accelerators/1700065902277.png">
<meta property="og:image" content="http://example.com/2023/11/15/Designing_DNN_Accelerators/1700065547456.png">
<meta property="og:image" content="http://example.com/2023/11/15/Designing_DNN_Accelerators/1700124708788.png">
<meta property="og:image" content="http://example.com/2023/11/15/Designing_DNN_Accelerators/1700134333058.png">
<meta property="og:image" content="http://example.com/2023/11/15/Designing_DNN_Accelerators/1700134346761.png">
<meta property="og:image" content="http://example.com/2023/11/15/Designing_DNN_Accelerators/1700134358771.png">
<meta property="og:image" content="http://example.com/2023/11/15/Designing_DNN_Accelerators/1700135701893.png">
<meta property="og:image" content="http://example.com/2023/11/15/Designing_DNN_Accelerators/1700136845875.png">
<meta property="og:image" content="http://example.com/2023/11/15/Designing_DNN_Accelerators/1700136924461.png">
<meta property="og:image" content="http://example.com/2023/11/15/Designing_DNN_Accelerators/1700137378744.png">
<meta property="og:image" content="http://example.com/2023/11/15/Designing_DNN_Accelerators/1700150870447.png">
<meta property="og:image" content="http://example.com/2023/11/15/Designing_DNN_Accelerators/1700190658621.png">
<meta property="og:image" content="http://example.com/2023/11/15/Designing_DNN_Accelerators/1700191310508.png">
<meta property="og:image" content="http://example.com/2023/11/15/Designing_DNN_Accelerators/1700192611144.png">
<meta property="og:image" content="http://example.com/2023/11/15/Designing_DNN_Accelerators/1700195392726.png">
<meta property="og:image" content="http://example.com/2023/11/15/Designing_DNN_Accelerators/1700195681895.png">
<meta property="og:image" content="http://example.com/2023/11/15/Designing_DNN_Accelerators/1700197338646.png">
<meta property="og:image" content="http://example.com/2023/11/15/Designing_DNN_Accelerators/1700305038591.png">
<meta property="og:image" content="http://example.com/2023/11/15/Designing_DNN_Accelerators/1700305564774.png">
<meta property="og:image" content="http://example.com/2023/11/15/Designing_DNN_Accelerators/1700305697758.png">
<meta property="og:image" content="http://example.com/2023/11/15/Designing_DNN_Accelerators/1700305982329.png">
<meta property="og:image" content="http://example.com/2023/11/15/Designing_DNN_Accelerators/1700306005539.png">
<meta property="og:image" content="http://example.com/2023/11/15/Designing_DNN_Accelerators/1700306053391.png">
<meta property="og:image" content="http://example.com/2023/11/15/Designing_DNN_Accelerators/1700306283046.png">
<meta property="og:image" content="http://example.com/2023/11/15/Designing_DNN_Accelerators/1700306290812.png">
<meta property="article:published_time" content="2023-11-15T11:44:54.000Z">
<meta property="article:modified_time" content="2023-11-18T11:21:32.701Z">
<meta property="article:author" content="Treeby">
<meta property="article:tag" content="Study">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2023/11/15/Designing_DNN_Accelerators/1700057619410.png">

<link rel="canonical" href="http://example.com/2023/11/15/Designing_DNN_Accelerators/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Designing_DNN_Accelerators | Amusement Park</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Amusement Park</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Treeby's blog</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-github">

    <a href="https://github.com/satreeby" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>Github</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/11/15/Designing_DNN_Accelerators/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/author.jpg">
      <meta itemprop="name" content="Treeby">
      <meta itemprop="description" content="La vie est belle">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Amusement Park">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Designing_DNN_Accelerators
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-11-15 19:44:54" itemprop="dateCreated datePublished" datetime="2023-11-15T19:44:54+08:00">2023-11-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-11-18 19:21:32" itemprop="dateModified" datetime="2023-11-18T19:21:32+08:00">2023-11-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Notes-of-E%EF%AC%83cient-Processing-of-Deep-Neural-Networks/" itemprop="url" rel="index"><span itemprop="name">Notes of Eﬃcient Processing of Deep Neural Networks</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2023/11/15/Designing_DNN_Accelerators/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/11/15/Designing_DNN_Accelerators/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <blockquote>
<p>credit to Eﬃcient Processing of Deep Neural Networks》</p>
</blockquote>
<h2 id="key-metrics">Key Metrics</h2>
<ul>
<li><strong>Energy consumption</strong>
<ol type="1">
<li>减少数据的移动(data movement)</li>
<li>减少移动单位数据的代价</li>
</ol></li>
<li><strong>Performance in terms of throughput and latency</strong>
<ol type="1">
<li>增加并行度(parallel)</li>
<li>减少PE空闲周期数</li>
</ol></li>
<li><strong>Area</strong></li>
</ul>
<h2 id="key-properties-of-dnn-to-leverage">Key Properties of DNN to
Leverage</h2>
<p><strong><em>Data reuse</em></strong></p>
<ul>
<li><strong>Input feature map reuse</strong>
不同的滤波器(M)，相同的输入</li>
<li><strong>Filter reuse</strong> 同一个滤波器，不同样本(N)的输入</li>
<li><strong>Convolutional reuse</strong>
<ol type="1">
<li>每个filter的每个weight，复用 <span class="math inline">\(P\times
Q\)</span> 次，产生 <span class="math inline">\(P\times Q\)</span> 个
output 像素点</li>
<li>若步长 U=1，则每个 input 的像素，一般会与 <span class="math inline">\(R\times S\)</span> 个filter weight相乘，得到的
psum 属于不同的 output 像素</li>
</ol></li>
<li><strong>Movement of Partial Sums</strong> 得到一个输出的像素点，有
<span class="math inline">\(C \times R \times S\)</span> 个 psum 需要被
accumulated</li>
</ul>
<h2 id="dnn-hardware-design-consideratuions">DNN hardware design
Consideratuions</h2>
<p>设计一个 DNN 加速器，大致需要以下步骤：</p>
<ul>
<li><strong>At design time</strong>
<ol type="1">
<li>dataflow(s)</li>
<li>PE(process element)的数量，以及每个PE执行的MAC数量</li>
<li>the memory
hierarchy，包括存储的级数(levels)，以及每一级的容量(capicity)</li>
<li>the allowed pattern of NoC(Network on-chip)</li>
</ol></li>
<li><strong>At mapping time</strong> 将 DNN
网络有效的映射到硬件加速器上</li>
<li><strong>At configuration time</strong></li>
<li><strong>At run time</strong></li>
</ul>
<h2 id="data-reuse">Data reuse</h2>
<ul>
<li><strong>Temporal reuse</strong></li>
</ul>
<blockquote>
<ul>
<li><strong><em>Temporal reuse occurs when the same data value is used
more than once by the same consumer</em></strong></li>
<li>It can be exploited by adding an intermediate memory level to the
memory hierarchy of the hardware, where the intermediate memory level
has a smaller storage capacity than the level that acts as the original
source of the data</li>
<li>For exploiting temporal reuse, the reuse distance is defined as the
number of data accesses required by the consumer in between the accesses
to the same data value, which is a function of the ordering of
operations.</li>
</ul>
</blockquote>
<p>比如，以下1-D卷积，filter weight
的存储有两级，L0存放着所有权重，L1仅能存放数量为一的权重，如(d)，则两种不同的计算顺序(order)，其
weight reuse distance 也不同，(output reuse distance 也不同)。 <img src="/2023/11/15/Designing_DNN_Accelerators/1700057619410.png" alt="任我行"></p>
<p>因此，重要的是，<strong>reuse distance, 即 the processing
order</strong></p>
<ul>
<li><strong>Spatial reuse</strong></li>
</ul>
<blockquote>
<ul>
<li><strong><em>Spatial reuse occurs when the same data value is used by
more than one consumer (e.g., a group ofPEs) at different spatial
locations ofthe hardware.</em></strong></li>
<li>It can be exploited by reading the data once fromthe source memory
level andmulticasting it to all ofthe consumers.</li>
<li>For exploiting spatial reuse, the reuse distance is defined as the
maximum number of data accesses in between any pair ofconsumers that
access the same data value, which is again a function of the ordering of
operations.</li>
</ul>
</blockquote>
<p>比如，以下1-D卷积，有数量为4的 consumers(PE)，可用于同时计算 MAC，
<img src="/2023/11/15/Designing_DNN_Accelerators/1700058040471.png" alt="任我行"></p>
<p>因此，重要的是，<strong>reuse distance, 即 the designs of
parallel</strong></p>
<p>同时需要注意，spatial reuse 需要 Noc 来支持，与 Memory 的层级和带宽
(bandwidth) 都有关系。</p>
<ul>
<li>data reuse 设计关键点
<ol type="1">
<li>Process order</li>
<li>Parallel computation</li>
<li>Data tiling</li>
<li>同时考虑 bandwidth, Memory hierarchy 等</li>
</ol></li>
<li>算法(Algorithm)描述</li>
</ul>
<blockquote>
<ul>
<li>loop nests</li>
<li>WS, IS, OS</li>
<li><strong><em>for</em></strong></li>
</ul>
</blockquote>
<p>比如，使用伪代码描述下面一个1-D卷积，循环越靠近外层，说明其静态性(stationary)越高，
<img src="/2023/11/15/Designing_DNN_Accelerators/1700058946892.png" alt="任我行">
<img src="/2023/11/15/Designing_DNN_Accelerators/1700059062834.png" alt="任我行">
以图 (a) 的 WS 为例，完成本次卷积所有操作的 0-35 次 cycle 里面，追踪每次
cycle 用到的数据的索引 (Index) 如下图： <img src="/2023/11/15/Designing_DNN_Accelerators/1700059237627.png" alt="任我行"></p>
<blockquote>
<p><strong><em>parallel-for</em></strong></p>
</blockquote>
<p>比如，对上述的 <strong>WS</strong> 加入对 <strong>权重</strong>
的并行设计，即将权重的循环更进行的划分(Tiling)： <img src="/2023/11/15/Designing_DNN_Accelerators/1700059779411.png" alt="任我行">
每次执行的状况如下： <img src="/2023/11/15/Designing_DNN_Accelerators/1700059801549.png" alt="任我行">
可将之与无并行进行对比。 设计并行时，既要考虑 PE 数量，又要考虑 Memory
的容量与带宽，还要考虑划分是否整除，等等。</p>
<blockquote>
<p>A dataflow only defines the following aspects of a loop nest: (1) the
specific order of the loops to prioritize the data types; (2) the number
of loops for each data dimension to describe the tiling; and (3) whether
each of the loops is temporal (for) or spatial (parallel-for).</p>
</blockquote>
<h2 id="dataflow-taxonomy">Dataflow Taxonomy</h2>
<h3 id="weight-stationaryws">Weight Stationary(WS)</h3>
<blockquote>
<ul>
<li>The weight-stationary dataflow is designed to minimize the energy
consumption of reading weights by maximizing the reuse ofweights from
the register file (RF) at each PE</li>
<li>The processing runs as manyMACs that use the same weight as possible
while the weight is present in the RF</li>
<li>The inputs and partial sums must move through the spatial array and
global buffer. The input feature map activations are broadcast to all
PEs and then the partial sums are spatially accumulated across the PE
array.</li>
</ul>
</blockquote>
<figure>
<img src="/2023/11/15/Designing_DNN_Accelerators/1700062976339.png" alt="任我行">
<figcaption aria-hidden="true">任我行</figcaption>
</figure>
<p>比如，nn-X (also called neuFlow)，它有：</p>
<ul>
<li>8 个 2-D CONV engines</li>
<li>每个 engine 有 100 个 PE（因此可以实现最多<span class="math inline">\(10 \times 10\)</span>的卷积）</li>
<li>weight 在每个 PE 里保持静态不变</li>
<li>input 广播(broadcast) 至每个 PE 中</li>
<li>由于每次(cycle)所广播的只有一个 input
像素，为保证时序正确性，需要添加寄存器以控制 psum 的相加</li>
</ul>
<figure>
<img src="/2023/11/15/Designing_DNN_Accelerators/1700063409653.png" alt="任我行">
<figcaption aria-hidden="true">任我行</figcaption>
</figure>
<p>再比如，Nvidia’s Deep Learning Accelerator
(NVDLA)，与前面不同的是，psum 是一列列相加（不同列不同的 filter
，每一行则对应不同的 input(and filter) channel <img src="/2023/11/15/Designing_DNN_Accelerators/1700063949353.png" alt="任我行">
其算法如下： <img src="/2023/11/15/Designing_DNN_Accelerators/1700064715944.png" alt="任我行"></p>
<h3 id="output-stationaryos">Output Stationary(OS)</h3>
<blockquote>
<ul>
<li>The output-stationary dataflow is designed to minimize the energy
consumption of reading and writing the partial sums.</li>
<li>In order to keep the accumulation of partial sums stationary in the
RF, one common implementation is to stream the input activations across
the PE array and broadcast the weights to all PEs in the array from the
global buffer.</li>
</ul>
</blockquote>
<figure>
<img src="/2023/11/15/Designing_DNN_Accelerators/1700065902277.png" alt="任我行">
<figcaption aria-hidden="true">任我行</figcaption>
</figure>
<p>可以选择不同的 output 像素保持 stationary <img src="/2023/11/15/Designing_DNN_Accelerators/1700065547456.png" alt="任我行"></p>
<p>未完待续。。。</p>
<h3 id="input-stationaryis">Input Stationary(IS)</h3>
<blockquote>
<ul>
<li>Similar to the previous two dataflows, the input-stationary dataflow
is designed to minimize the energy consumption ofreading input
activations.</li>
<li>With minimized reuse distance, each input activation is read from
DRAM and put into the RF ofeach PE and stays stationary for further
access. Then, it runs through as many MACs as possible in the PE to
reuse the same input activation.</li>
<li>While each input activation stays stationary in the RF, unique
filter weights are uni-cast into the PEs at each cycle, while the
partial sums are spatially accumulated across the PEs to generate the
final output activation.</li>
</ul>
</blockquote>
<figure>
<img src="/2023/11/15/Designing_DNN_Accelerators/1700124708788.png" alt="任我行">
<figcaption aria-hidden="true">任我行</figcaption>
</figure>
<p>未完待续。。。</p>
<h3 id="row-stationaryrs">Row Stationary(RS)</h3>
<p>A row-stationary dataflow is proposed in <em>Eyeriss</em>, which aims
to maximize the reuse and accumulation at the RF level for all types of
data (weights, input activations, and partial sums) for the overall
energy efficiency.</p>
<ul>
<li><strong>1-D CONV</strong>：</li>
</ul>
<blockquote>
<p>weight stationary inside the RF streams the activations into PE
比如下面 S=3，W=5，U=1 的卷积，得到 F=3 的 output，需要三个 step <img src="/2023/11/15/Designing_DNN_Accelerators/1700134333058.png" alt="任我行"><img src="/2023/11/15/Designing_DNN_Accelerators/1700134346761.png" alt="1700134346761"><img src="/2023/11/15/Designing_DNN_Accelerators/1700134358771.png" alt="1700134358771"> 值得注意的是，filter 与 input 流进 PE 与 output
流出，都应使用 FIFO 进行正确的时序控制</p>
</blockquote>
<ul>
<li><strong>2-D CONV</strong>：</li>
</ul>
<blockquote>
<p>由 多个 1-D 卷积组成， 比如下面 R=3, S=3, H=5, W=5, U=1 的卷积，得到
E=3, F=3 的 output <img src="/2023/11/15/Designing_DNN_Accelerators/1700135701893.png" alt="任我行">
****</p>
</blockquote>
<blockquote>
<ol type="1">
<li>在这个例子中，每一行 output 的产生，仍然需要 3 个 steps</li>
<li>而每一个 step 所产生的一个 output 像素点，都需要 3 row 的 1-D
卷积同时进行，然后将对应的 psum 相加(accumulated) 得到</li>
<li>得到所有行的 output 需要进行 3 次上述的操作</li>
<li><strong>由上述例子可得：每一 Row 的 filter weights 在同一 Row 的 PE
上复用；每一 ROW 的 inputs 则按 相同的 diagnal 复用； 每一 col 的 PE
得到的 psum 要进行相加</strong></li>
</ol>
</blockquote>
<ul>
<li><strong>Higher-dimensional CONV</strong>:</li>
</ul>
<blockquote>
<p><strong>N, M, C</strong>三个维度 <strong>Interleaving</strong> or
<strong>concatenating</strong> 有下面三种复用：(a) filter reuse of
multiple (<strong>N</strong>) input (b) input reuse of multiple
(<strong>M</strong>) filters (c) output reuse of multiple filter weights
and inputs (<strong>C</strong>) <img src="/2023/11/15/Designing_DNN_Accelerators/1700136845875.png" alt="任我行">
对应的techniques可以是：(a) concatenating (b) interleaving (c)
interleaving <img src="/2023/11/15/Designing_DNN_Accelerators/1700136924461.png" alt="任我行"> 存在问题：PE 阵列的大小是 fixed 的，应如何将不同 shape
的 DNN layer 映射呢？两大techniques：(a) replication (b) folding <img src="/2023/11/15/Designing_DNN_Accelerators/1700137378744.png" alt="任我行">
总的思想是：提高 PE 的利用率 注意：不使用的 PE 应关上使其耗能减少。</p>
</blockquote>
<ul>
<li><strong>硬件结构支持</strong></li>
</ul>
<ol type="1">
<li>PE array</li>
<li>Mapping and Configure</li>
<li>Noc</li>
<li>Memory hierarchy</li>
</ol>
<h3 id="other-stationary">Other Stationary</h3>
<blockquote>
<ul>
<li>Since the stationariness of a dataflow is only relative to a
specific level of memory hierarchy, different stationariness can be used
at each level of the memory hierarchy.</li>
<li>From the perspective ofa loop nest, it involves tiling the various
data types into multiple levels and then reordering the loops at
different levels to prioritize different data types.</li>
<li>For example, ifthere are K levels ofmemory hierarchy, both dimension
Q and S in the loop nest ofFigure 5.8a can be further divided up into K
loops (i.e., for the open ranges [Q0, QK) and [S0 to SK) ) and then
reordering the loops independently from loop level 0 to level K -
1.</li>
<li><strong>This also implies that smaller DNN accelerator designs can
be further combined together with a new level ofmemory to form a larger
accelerator.</strong></li>
<li><strong>The key to these designs is to propose flexible NoCs and
support various memory access patterns in order to execute different
dataflows that have different numbers ofloop levels and loop ordering in
the loop nest</strong></li>
<li>上面的讨论基于一个layer无法在PE中一次就计算完成，然而，若layer足够小，或PE足够大，还需讨论<strong>跨层处理、流水线</strong>等技术</li>
</ul>
</blockquote>
<h2 id="dnn-accelerator-buffer-management-strategies">DNN Accelerator
Buffer Management Strategies</h2>
<p>可大致分为四种结构：</p>
<ul>
<li>implicit/explicit（隐式/显式）:
指的是利用工作负载知识来控制数据缓冲决策的程度</li>
<li>coupled/decoupled（耦合/解耦）:
指的是内存响应和请求是往返的(请求-响应)还是前向的(数据自动推送给使用者)
<img src="/2023/11/15/Designing_DNN_Accelerators/1700150870447.png" alt="好"></li>
</ul>
<h3 id="eddoexplicit-decoupled-data-orchestration">EDDO(Explicit
Decoupled Data Orchestration)</h3>
<p><strong><em>buffet</em></strong></p>
<ul>
<li><em>FIFO</em></li>
<li>fill: from an <em>NoC</em> link into the <em>tail</em></li>
<li>read: <em>read command</em> + <em>read address</em>(offset of
<em>head</em>)</li>
<li>update: <em>read + update command</em> + <em>update
address</em></li>
<li>shrink: removes a given number ofvalues from the head of the buffet
by adjusting the head pointer <img src="/2023/11/15/Designing_DNN_Accelerators/1700190658621.png" alt="1700190658621"></li>
</ul>
<p>比如，实现一维卷积时，读入 input
数据的序列为：0，1，2；1，2，3；2，3，4…… 而 psum
的读入并更新的序列应对应为：0，0，0；1，1，1；2，2，2…… <img src="/2023/11/15/Designing_DNN_Accelerators/1700191310508.png" alt="1700191310508"></p>
<h2 id="flexible-noc-design">Flexible Noc design</h2>
<p>要考虑的是： &gt; (1) support processing with high parallelism by
efficiently delivering data between storage and datapaths; (2) exploit
data reuse to reduce the bandwidth requirement and improve energy
efficiency; and (3) can be scaled at a reasonable implementation
cost.</p>
<figure>
<img src="/2023/11/15/Designing_DNN_Accelerators/1700192611144.png" alt="1700192611144">
<figcaption aria-hidden="true">1700192611144</figcaption>
</figure>
<p>比如： <img src="/2023/11/15/Designing_DNN_Accelerators/1700195392726.png" alt="1700195392726"></p>
<ul>
<li>每一 row 的 weight 来自不同的 filter (M)，同一 row 中的 weight
来自不同的 channel(C)，stationary</li>
<li>每一 col 的 input 来自不同的 channel(C)</li>
<li>同一 row 的 psum 相加后在传输到 psum buffer</li>
<li>input activations (iacts) are reused vertically and partial sums
(psums) are accumulated horizontally</li>
</ul>
<figure>
<img src="/2023/11/15/Designing_DNN_Accelerators/1700195681895.png" alt="1700195681895">
<figcaption aria-hidden="true">1700195681895</figcaption>
</figure>
<ul>
<li>每一 row 的 weight 来自不同的 filter (M) 或者 同一 filter
但不同的位置</li>
<li>每一 col 的 input 都不同空间位置 (H, W)</li>
<li>input activations (iacts) are reused vertically and weights are
reused horizontally</li>
</ul>
<p>三种通信方式的优缺点： <img src="/2023/11/15/Designing_DNN_Accelerators/1700197338646.png" alt="1700197338646"></p>
<blockquote>
<p><strong>Hierarchical Mesh Network</strong></p>
</blockquote>
<p>hierarchical mesh network(HM-NoC) <img src="/2023/11/15/Designing_DNN_Accelerators/1700305038591.png" alt="1700305038591"></p>
<ul>
<li>2 levels</li>
<li>4 modes</li>
</ul>
<p>例子： <img src="/2023/11/15/Designing_DNN_Accelerators/1700305564774.png" alt="1700305564774"></p>
<figure>
<img src="/2023/11/15/Designing_DNN_Accelerators/1700305697758.png" alt="1700305697758">
<figcaption aria-hidden="true">1700305697758</figcaption>
</figure>
<h2 id="mapping">mapping</h2>
<p>In the processing ofDNNs, the mapper translates the desired DNN layer
computation (i.e., problem specification) along with its shape and size4
into a hardware- compatible mapping for execution. <img src="/2023/11/15/Designing_DNN_Accelerators/1700305982329.png" alt="1700305982329"></p>
<p>类比cpu： <img src="/2023/11/15/Designing_DNN_Accelerators/1700306005539.png" alt="1700306005539"></p>
<p>mapper 框图： <img src="/2023/11/15/Designing_DNN_Accelerators/1700306053391.png" alt="1700306053391"></p>
<p>根据 Problem Spec/Shape 以及约束 Dataflow(s)/Constraints 在解集
mapper space 里面搜索出最优解，然后对 DNN Accelerator 进行配置</p>
<p>映射的算法可以用 loop nest 来表示，比如 <img src="/2023/11/15/Designing_DNN_Accelerators/1700306283046.png" alt="1700306283046"><img src="/2023/11/15/Designing_DNN_Accelerators/1700306290812.png" alt="1700306290812"></p>

    </div>

    
    
    <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------END<i class="fa fa-paw"></i>Best Wishes-------------</div>
    
</div>


      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/Study/" rel="tag"><i class="fa fa-tag"></i> Study</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2023/11/15/2023%E7%A7%8B/" rel="prev" title="2023秋">
      <i class="fa fa-chevron-left"></i> 2023秋
    </a></div>
      <div class="post-nav-item">
    <a href="/2023/11/15/Kernel_Computation/" rel="next" title="Kernel_Computation">
      Kernel_Computation <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#key-metrics"><span class="nav-number">1.</span> <span class="nav-text">Key Metrics</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#key-properties-of-dnn-to-leverage"><span class="nav-number">2.</span> <span class="nav-text">Key Properties of DNN to
Leverage</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#dnn-hardware-design-consideratuions"><span class="nav-number">3.</span> <span class="nav-text">DNN hardware design
Consideratuions</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#data-reuse"><span class="nav-number">4.</span> <span class="nav-text">Data reuse</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#dataflow-taxonomy"><span class="nav-number">5.</span> <span class="nav-text">Dataflow Taxonomy</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#weight-stationaryws"><span class="nav-number">5.1.</span> <span class="nav-text">Weight Stationary(WS)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#output-stationaryos"><span class="nav-number">5.2.</span> <span class="nav-text">Output Stationary(OS)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#input-stationaryis"><span class="nav-number">5.3.</span> <span class="nav-text">Input Stationary(IS)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#row-stationaryrs"><span class="nav-number">5.4.</span> <span class="nav-text">Row Stationary(RS)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#other-stationary"><span class="nav-number">5.5.</span> <span class="nav-text">Other Stationary</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#dnn-accelerator-buffer-management-strategies"><span class="nav-number">6.</span> <span class="nav-text">DNN Accelerator
Buffer Management Strategies</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#eddoexplicit-decoupled-data-orchestration"><span class="nav-number">6.1.</span> <span class="nav-text">EDDO(Explicit
Decoupled Data Orchestration)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#flexible-noc-design"><span class="nav-number">7.</span> <span class="nav-text">Flexible Noc design</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mapping"><span class="nav-number">8.</span> <span class="nav-text">mapping</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Treeby"
      src="/images/author.jpg">
  <p class="site-author-name" itemprop="name">Treeby</p>
  <div class="site-description" itemprop="description">La vie est belle</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">10</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/satreeby" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;satreeby" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:satreeby@gmail.com" title="E-Mail → mailto:satreeby@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      friendly link
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://ltnsxd.github.io/" title="https:&#x2F;&#x2F;ltnsxd.github.io" rel="noopener" target="_blank">LTNS</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Treeby</span>
</div><div>
<!--添加网站运行时间-->
<span>小破站已经在风雨中度过了</span>
<span id="timeDate">载入天数...</span>
<span id="times">载入时分秒...</span>
<script>
    function createtime() {
        const startTime = '06/28/2023 20:13:14',
            start = new Date(startTime)
        let mill = new Date() - start,
            seconds = Math.floor(mill / 1000),
            mins = Math.floor(seconds / 60),
            hours = Math.floor(mins / 60),
            days = Math.floor(hours / 24)
        const time = {
            seconds: seconds - mins * 60,
            mins: mins - hours * 60,
            hours: hours - days * 24,
        }
        for (const k in time) {
            time[k] = `${time[k]}`.padStart(2, '0')
        }
        document.getElementById("timeDate").innerHTML = ` ${days} 天`
        document.getElementById("times").innerHTML = ` ${time.hours} 小时 ${time.mins} 分 ${time.seconds} 秒`
    }
    setInterval(createtime, 500)
</script>
</div>
<script color="0,0,255" opacity="0.5" zIndex="-1" count="99" src="https://cdn.jsdelivr.net/npm/canvas-nest.js@1/dist/canvas-nest.js"></script>

        








      </div>
    </footer>
  </div>

  
  <script size="300" alpha="0.6" zIndex="-1" src="/lib/canvas-ribbon/canvas-ribbon.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>




  















  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
          load: ['[tex]/mhchem'],
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
          packages: {'[+]': ['mhchem']},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : '6zRY3CX7EmWrElP42NGxNKsd-gzGzoHsz',
      appKey     : '1v8aaMV8PG0GgDS8Sqwnt9EM',
      placeholder: "帅呆啦！",
      avatar     : 'monsterid',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : true,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
